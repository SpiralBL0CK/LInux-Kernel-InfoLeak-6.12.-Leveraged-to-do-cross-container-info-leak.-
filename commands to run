# Remove old container if exists
sudo docker rm -f victim_db 2>/dev/null

sudo docker run -d --name victim_db --device=/dev/udmabuf -e POSTGRES_PASSWORD=CTF_FLAG{real_hugepage_leak_2024}   -e SECRET_API_KEY=sk-live-DEADBEEF1337CAFE   postgres:latest -c huge_pages=try -c shared_buffers=256MB

sudo docker run -it --rm --device=/dev/udmabuf  -v ~/Desktop:/mnt ubuntu:24.04 bash

# spray
while true; do   sudo docker exec victim_db psql -U postgres -c "
       CREATE TABLE IF NOT EXISTS secrets(data TEXT);
       INSERT INTO secrets VALUES('PASSWORD=CTF_FLAG{real_hugepage_leak_2024}');
       INSERT INTO secrets VALUES('API_KEY=sk-live-DEADBEEF1337CAFE');
       SELECT * FROM secrets;
       DROP TABLE secrets;
     " 2>/dev/null;   sleep 1; done
for i in {1..10000}; do   sudo docker exec victim_db psql -U postgres -c "SELECT 'CTF_FLAG{real_hugepage_leak_2024}' as password;"; done
for i in {1..10000}; do   sudo docker exec victim_db psql -U postgres -c "SELECT 'CTF_FLAG{real_hugepage_leak_2024}' as password;"; done
for i in {1..10000}; do   sudo docker exec victim_db psql -U postgres -c "SELECT 'CTF_FLAG{real_hugepage_leak_2024}' as password;"; done
for i in {1..10000}; do   sudo docker exec victim_db psql -U postgres -c "SELECT 'CTF_FLAG{real_hugepage_leak_2024}' as password;"; done
for i in {1..10000}; do   sudo docker exec victim_db psql -U postgres -c "SELECT 'CTF_FLAG{real_hugepage_leak_2024}' as password;"; done
for i in {1..10000}; do   sudo docker exec victim_db psql -U postgres -c "SELECT 'CTF_FLAG{real_hugepage_leak_2024}' as password;"; done

./postgres.sh
